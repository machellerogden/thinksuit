{
    "$id": "thinksuit/plan.v1",
    "type": "object",
    "required": [
        "strategy",
        "name"
    ],
    "properties": {
        "name": {
            "type": "string",
            "description": "Unique identifier for this plan, used for precedence matching"
        },
        "strategy": {
            "enum": [
                "direct",
                "task",
                "sequential",
                "parallel"
            ]
        },
        "sequence": {
            "type": "array",
            "items": {
                "oneOf": [
                    {
                        "type": "string"
                    },
                    {
                        "type": "object",
                        "properties": {
                            "role": {
                                "type": "string"
                            },
                            "strategy": {
                                "enum": ["direct", "task"],
                                "description": "Execution strategy for this step"
                            },
                            "adaptations": {
                                "type": "array",
                                "items": {
                                    "type": "string"
                                },
                                "description": "Adaptation keys for this step (looked up in module.adaptations, applied in order)"
                            },
                            "tools": {
                                "type": "array",
                                "items": {
                                    "type": "string"
                                },
                                "description": "Tools available to this step"
                            },
                            "resolution": {
                                "type": "object",
                                "properties": {
                                    "maxCycles": {"type": "number"},
                                    "maxTokens": {"type": "number"},
                                    "maxToolCalls": {"type": "number"},
                                    "timeoutMs": {"type": "number"}
                                },
                                "description": "Execution resolution contract for task strategy steps"
                            }
                        },
                        "required": [
                            "role"
                        ]
                    }
                ]
            }
        },
        "roles": {
            "type": "array",
            "items": {
                "oneOf": [
                    {
                        "type": "string"
                    },
                    {
                        "type": "object",
                        "properties": {
                            "role": {
                                "type": "string"
                            },
                            "strategy": {
                                "enum": ["direct", "task"],
                                "description": "Execution strategy for this role"
                            },
                            "adaptations": {
                                "type": "array",
                                "items": {
                                    "type": "string"
                                },
                                "description": "Adaptation keys for this branch (looked up in module.adaptations, applied in order)"
                            },
                            "tools": {
                                "type": "array",
                                "items": {
                                    "type": "string"
                                },
                                "description": "Tools available to this branch"
                            },
                            "resolution": {
                                "type": "object",
                                "properties": {
                                    "maxCycles": {"type": "number"},
                                    "maxTokens": {"type": "number"},
                                    "maxToolCalls": {"type": "number"},
                                    "timeoutMs": {"type": "number"}
                                },
                                "description": "Execution resolution contract for task strategy branches"
                            }
                        },
                        "required": [
                            "role"
                        ]
                    }
                ]
            }
        },
        "role": {
            "type": "string",
            "description": "Role to execute for direct/task strategies"
        },
        "adaptations": {
            "type": "array",
            "items": {
                "type": "string"
            },
            "description": "Adaptation keys to apply (looked up in module.adaptations, typically for direct/task strategies, applied in order)"
        },
        "rationale": {
            "type": "string"
        },
        "maxTokens": {
            "type": "number"
        },
        "threadAccumulation": {
            "type": "boolean",
            "default": true,
            "description": "Whether to accumulate conversation thread between sequential steps (defaults to true)"
        },
        "resultStrategy": {
            "enum": [
                "last",
                "concat",
                "label",
                "formatted"
            ],
            "description": "How to combine results: 'last' returns final output, 'concat' merges all outputs, 'label' adds role labels, 'formatted' uses module formatter"
        },
        "latency": {
            "enum": [
                "low",
                "medium",
                "high"
            ],
            "description": "Expected response time characteristics of this plan"
        },
        "cost": {
            "enum": [
                "low",
                "medium",
                "high"
            ],
            "description": "Expected token/API cost of this plan"
        },
        "risks": {
            "type": "array",
            "items": {
                "type": "string"
            },
            "description": "Known risk factors for this plan (e.g., 'dependency-chain', 'high-latency')"
        },
        "assumptions": {
            "type": "array",
            "items": {
                "type": "string"
            },
            "description": "Assumptions this plan makes about the input or context"
        },
        "coverage": {
            "type": "array",
            "items": {
                "type": "string"
            },
            "description": "Signals or contracts this plan addresses (e.g., 'contract.explore', 'contract.analyze')"
        },
        "resolution": {
            "type": "object",
            "properties": {
                "maxCycles": {"type": "number"},
                "maxTokens": {"type": "number"},
                "maxToolCalls": {"type": "number"},
                "timeoutMs": {"type": "number"}
            },
            "description": "Execution resolution contract for task strategy"
        }
    },
    "additionalProperties": true
}
